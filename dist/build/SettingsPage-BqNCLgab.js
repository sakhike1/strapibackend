import{a as p,r as M,j as e,cy as g,H as P,e8 as r,aL as ae,e9 as H,y as A,x as E,ea as se,a6 as _,D as $,b3 as te,d7 as x,f as S,T as j,bo as q,a1 as D,bh as ne,b4 as B,eb as G,K as F,cA as V,J as re,b8 as ie,N as oe,O as L,aX as le,aY as de,ec as ce,bK as z,I as Q,bD as ue,bL as ge,h as he,ed as me,Y as fe,bE as xe,$ as k,bF as I,bH as je,Z as pe,a0 as T,P as w,ee as U,ef as be,B as ye,cp as Se,eg as Me,eh as Ce,E as N,cs as ve,ct as Le,aI as Ae,s as Ee,bp as Ie}from"./strapi-Ct9MU9_y.js";const K=a=>a.name!==void 0,O=({disabled:a,variant:n="default"})=>{const{formatMessage:t}=p(),[s,d]=M.useState(!1);return e.jsxs(g.Root,{open:s,onOpenChange:d,children:[e.jsx(g.Trigger,{children:e.jsx(P,{variant:n,disabled:a,startIcon:e.jsx(ae,{}),onClick:()=>d(!0),size:"S",children:t({id:r("Settings.list.actions.add"),defaultMessage:"Add new locale"})})}),e.jsx(we,{onClose:()=>d(!1)})]})},W=te().shape({code:B().nullable().required({id:"Settings.locales.modal.create.code.error",defaultMessage:"Please select a locale"}),name:B().nullable().max(50,{id:"Settings.locales.modal.create.name.error.min",defaultMessage:"The locale display name can only be less than 50 characters."}).required({id:"Settings.locales.modal.create.name.error.required",defaultMessage:"Please give the locale a display name"}),isDefault:ne()}),Te={code:"",name:"",isDefault:!1},we=({onClose:a})=>{const n=H(),{toggleNotification:t}=A(),{_unstableFormatAPIError:s,_unstableFormatValidationErrors:d}=E(),[c]=se(),{formatMessage:o}=p(),i=_("CreateModal",u=>u.refetchPermissions),l=async(u,h)=>{try{const m=await c(u);if("error"in m){K(m.error)&&m.error.name==="ValidationError"?h.setErrors(d(m.error)):t({type:"danger",message:s(m.error)});return}t({type:"success",message:o({id:r("Settings.locales.modal.create.success"),defaultMessage:"Locale successfully added"})}),i(),a()}catch{t({type:"danger",message:o({id:"notification.error",defaultMessage:"An error occurred, please try again"})})}};return e.jsx(g.Content,{children:e.jsxs($,{method:"POST",initialValues:Te,validationSchema:W,onSubmit:l,children:[e.jsx(g.Header,{children:e.jsx(g.Title,{children:o({id:r("Settings.list.actions.add"),defaultMessage:"Add new locale"})})}),e.jsx(g.Body,{children:e.jsxs(x.Root,{variant:"simple",defaultValue:"basic",children:[e.jsxs(S,{justifyContent:"space-between",children:[e.jsx(j,{tag:"h2",variant:"beta",id:n,children:o({id:r("Settings.locales.modal.title"),defaultMessage:"Configuration"})}),e.jsxs(x.List,{"aria-labelledby":n,children:[e.jsx(x.Trigger,{value:"basic",children:o({id:r("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),e.jsx(x.Trigger,{value:"advanced",children:o({id:r("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),e.jsx(q,{}),e.jsxs(D,{paddingTop:7,paddingBottom:7,children:[e.jsx(x.Content,{value:"basic",children:e.jsx(J,{})}),e.jsx(x.Content,{value:"advanced",children:e.jsx(X,{})})]})]})}),e.jsxs(g.Footer,{children:[e.jsx(g.Close,{children:e.jsx(P,{variant:"tertiary",children:o({id:"app.components.Button.cancel",defaultMessage:"Cancel"})})}),e.jsx(Y,{})]})]})})},Y=()=>{const{formatMessage:a}=p(),n=V("SubmitButton",s=>s.isSubmitting),t=V("SubmitButton",s=>s.modified);return e.jsx(P,{type:"submit",startIcon:e.jsx(re,{}),disabled:n||!t,children:a({id:"global.save",defaultMessage:"Save"})})},J=({mode:a="create"})=>{const{formatMessage:n}=p(),{toggleNotification:t}=A(),{_unstableFormatAPIError:s}=E(),{data:d,error:c}=G();if(M.useEffect(()=>{c&&t({type:"danger",message:s(c)})},[c,s,t]),!Array.isArray(d))return null;const o=d.map(l=>({label:l.name,value:l.code})),i=[{disabled:a!=="create",label:{id:r("Settings.locales.modal.create.code.label"),defaultMessage:"Locales"},name:"code",options:o,placeholder:{id:"components.placeholder.select",defaultMessage:"Select"},required:!0,size:6,type:"enumeration"},{hint:{id:r("Settings.locales.modal.create.name.label.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"},label:{id:r("Settings.locales.modal.create.name.label"),defaultMessage:"Locale display name"},name:"name",required:!0,size:6,type:"string"}].map(l=>({...l,hint:l.hint?n(l.hint):void 0,label:n(l.label),placeholder:l.placeholder?n(l.placeholder):void 0}));return e.jsx(F.Root,{gap:4,children:i.map(({size:l,...u})=>e.jsx(F.Item,{col:l,direction:"column",alignItems:"stretch",children:e.jsx(Z,{...u})},u.name))})},X=({isDefaultLocale:a})=>{const{formatMessage:n}=p(),t=[{disabled:a,hint:{id:r("Settings.locales.modal.advanced.setAsDefault.hint"),defaultMessage:"One default locale is required, change it by selecting another one"},label:{id:r("Settings.locales.modal.advanced.setAsDefault"),defaultMessage:"Set as default locale"},name:"isDefault",size:6,type:"boolean"}].map(s=>({...s,hint:s.hint?n(s.hint):void 0,label:n(s.label)}));return e.jsx(F.Root,{gap:4,children:t.map(({size:s,...d})=>e.jsx(F.Item,{col:s,direction:"column",alignItems:"stretch",children:e.jsx(Z,{...d})},d.name))})},Z=a=>{switch(a.type){case"enumeration":return e.jsx(Fe,{...a});default:return e.jsx(ie,{...a})}},Fe=({disabled:a,hint:n,label:t,name:s,options:d,placeholder:c,required:o})=>{const{value:i,error:l,onChange:u}=oe(s),{data:h=[]}=G(),m=f=>{if(Array.isArray(h)){const C=h.find(y=>y.code===f);u(s,f),u("name",C.name)}else u(s,f)};return e.jsxs(L.Root,{error:l,hint:n,name:s,required:o,children:[e.jsx(L.Label,{children:t}),e.jsx(le,{disabled:a,onChange:m,placeholder:c,value:i,children:d.map(f=>e.jsx(de,{value:f.value,children:f.label},f.value))}),e.jsx(L.Error,{}),e.jsx(L.Hint,{})]})},Pe=({id:a,name:n})=>{const{formatMessage:t}=p(),{toggleNotification:s}=A(),{_unstableFormatAPIError:d}=E(),[c,o]=M.useState(!1),[i]=ce(),l=async()=>{try{const u=await i(a);if("error"in u){s({type:"danger",message:d(u.error)});return}s({type:"success",message:t({id:r("Settings.locales.modal.delete.success"),defaultMessage:"Deleted locale"})}),o(!1)}catch{s({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred, please try again"})})}};return e.jsxs(z.Root,{open:c,onOpenChange:o,children:[e.jsx(z.Trigger,{children:e.jsx(Q,{onClick:()=>o(!0),label:t({id:r("Settings.list.actions.delete"),defaultMessage:"Delete {name} locale"},{name:n}),variant:"ghost",children:e.jsx(ue,{})})}),e.jsx(ge,{onConfirm:l})]})},De=a=>{const{formatMessage:n}=p(),[t,s]=M.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{onClick:()=>s(!0),label:n({id:r("Settings.list.actions.edit"),defaultMessage:"Edit {name} locale"},{name:a.name}),variant:"ghost",children:e.jsx(he,{})}),e.jsx(ee,{...a,open:t,onOpenChange:s})]})},ee=({id:a,code:n,isDefault:t,name:s,open:d,onOpenChange:c})=>{const{toggleNotification:o}=A(),{_unstableFormatAPIError:i,_unstableFormatValidationErrors:l}=E(),u=_("EditModal",y=>y.refetchPermissions),{formatMessage:h}=p(),m=H(),[f]=me(),C=async({code:y,...R},v)=>{try{const b=await f({id:a,...R});if("error"in b){K(b.error)&&b.error.name==="ValidationError"?v.setErrors(l(b.error)):o({type:"danger",message:i(b.error)});return}o({type:"success",message:h({id:r("Settings.locales.modal.edit.success"),defaultMessage:"Locale successfully edited"})}),u(),c(!1)}catch{o({type:"danger",message:h({id:"notification.error",defaultMessage:"An error occurred, please try again"})})}};return e.jsx(g.Root,{open:d,onOpenChange:c,children:e.jsx(g.Content,{children:e.jsxs($,{method:"PUT",onSubmit:C,initialValues:{code:n,name:s,isDefault:t},validationSchema:W,children:[e.jsx(g.Header,{children:e.jsx(g.Title,{children:h({id:r("Settings.list.actions.edit"),defaultMessage:"Edit a locale"},{name:s})})}),e.jsx(g.Body,{children:e.jsxs(x.Root,{variant:"simple",defaultValue:"basic",children:[e.jsxs(S,{justifyContent:"space-between",children:[e.jsx(j,{tag:"h2",variant:"beta",id:m,children:h({id:r("Settings.locales.modal.title"),defaultMessage:"Configuration"})}),e.jsxs(x.List,{"aria-labelledby":m,children:[e.jsx(x.Trigger,{value:"basic",children:h({id:r("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),e.jsx(x.Trigger,{value:"advanced",children:h({id:r("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),e.jsx(q,{}),e.jsxs(D,{paddingTop:7,paddingBottom:7,children:[e.jsx(x.Content,{value:"basic",children:e.jsx(J,{mode:"edit"})}),e.jsx(x.Content,{value:"advanced",children:e.jsx(X,{isDefaultLocale:t})})]})]})}),e.jsxs(g.Footer,{children:[e.jsx(g.Close,{children:e.jsx(P,{variant:"tertiary",children:h({id:"app.components.Button.cancel",defaultMessage:"Cancel"})})}),e.jsx(Y,{})]})]})})})},Re=({locales:a=[],canDelete:n,canUpdate:t})=>{const[s,d]=M.useState(),{formatMessage:c}=p(),o=i=>()=>{t&&d(i)};return e.jsxs(fe,{colCount:4,rowCount:a.length+1,children:[e.jsx(xe,{children:e.jsxs(k,{children:[e.jsx(I,{children:e.jsx(j,{variant:"sigma",textColor:"neutral600",children:c({id:r("Settings.locales.row.id"),defaultMessage:"ID"})})}),e.jsx(I,{children:e.jsx(j,{variant:"sigma",textColor:"neutral600",children:c({id:r("Settings.locales.row.displayName"),defaultMessage:"Display name"})})}),e.jsx(I,{children:e.jsx(j,{variant:"sigma",textColor:"neutral600",children:c({id:r("Settings.locales.row.default-locale"),defaultMessage:"Default locale"})})}),e.jsx(I,{children:e.jsx(je,{children:"Actions"})})]})}),e.jsx(pe,{children:a.map(i=>e.jsxs(M.Fragment,{children:[e.jsxs(k,{onClick:o(i.id),style:{cursor:t?"pointer":"default"},children:[e.jsx(T,{children:e.jsx(j,{textColor:"neutral800",children:i.id})}),e.jsx(T,{children:e.jsx(j,{textColor:"neutral800",children:i.name})}),e.jsx(T,{children:e.jsx(j,{textColor:"neutral800",children:i.isDefault?c({id:r("Settings.locales.default"),defaultMessage:"Default"}):null})}),e.jsx(T,{children:e.jsxs(S,{gap:1,justifyContent:"flex-end",onClick:l=>l.stopPropagation(),children:[t&&e.jsx(De,{...i}),n&&!i.isDefault&&e.jsx(Pe,{...i})]})})]}),e.jsx(ee,{...i,onOpenChange:()=>d(void 0),open:s===i.id})]},i.id))})]})},Be=({children:a,error:n})=>{const{_unstableFormatAPIError:t}=E();return n?e.jsx(Ie,{label:t(n),style:{maxWidth:"200px"},children:a}):a},Ve=()=>{const{formatMessage:a}=p(),{toggleNotification:n}=A(),{data:t,isLoading:s,error:d}=be(),{isLoading:c,allowedActions:{canUpdate:o,canCreate:i,canDelete:l}}=ye(U),u=Se(),{data:h,isLoading:m,error:f}=Me(),[C]=Ce(),y=async v=>{try{await C({aiLocalizations:v}).unwrap(),n({type:"success",message:a({id:"notification.form.success.fields"})})}catch(b){console.error(b),n({type:"danger",message:a({id:"notification.error",defaultMessage:"An error occurred"})})}};return s||c||m?e.jsx(w.Loading,{}):d||!Array.isArray(t)?e.jsx(w.Error,{}):e.jsxs(w.Main,{tabIndex:-1,children:[e.jsx(N.Header,{primaryAction:e.jsx(O,{disabled:!i}),title:a({id:r("plugin.name"),defaultMessage:"Internationalization"}),subtitle:a({id:r("Settings.list.description"),defaultMessage:"Configure the settings"})}),e.jsxs(N.Content,{children:[u&&window.strapi.future.isEnabled("unstableAILocalizations")&&e.jsxs(S,{background:"neutral0",padding:6,marginBottom:6,shadow:"filterShadow",hasRadius:!0,children:[e.jsxs(S,{direction:"column",alignItems:"stretch",gap:1,flex:1,children:[e.jsxs(S,{gap:1,children:[e.jsx(D,{color:"alternative700",children:e.jsx(ve,{})}),e.jsx(j,{variant:"delta",tag:"h2",children:a({id:r("Settings.aiLocalizations.label"),defaultMessage:"AI Translations"})})]}),e.jsx(j,{variant:"pi",textColor:"neutral600",fontSize:"14px",children:a({id:r("Settings.aiLocalizations.description"),defaultMessage:"Everytime you save in the Content Manager, our AI will use your default locale to translate all other locales automatically."})})]}),e.jsx(L.Root,{name:"aiLocalizations",minWidth:"200px",children:e.jsx(Be,{error:f,children:e.jsx(Le,{disabled:!!f,checked:h?.data?.aiLocalizations??!1,offLabel:a({id:"app.components.ToggleCheckbox.disabled-label",defaultMessage:"Disabled"}),onLabel:a({id:"app.components.ToggleCheckbox.enabled-label",defaultMessage:"Enabled"}),onChange:v=>y(v.target.checked)})})})]}),t.length>0?e.jsx(Re,{locales:t,canDelete:l,canUpdate:o}):e.jsx(Ae,{icon:e.jsx(Ee,{width:void 0,height:void 0}),content:a({id:r("Settings.list.empty.title"),defaultMessage:"There are no locales"}),action:e.jsx(O,{disabled:!i,variant:"secondary"})})]})]})},ke=()=>e.jsx(w.Protect,{permissions:U.read,children:e.jsx(Ve,{})});export{ke as ProtectedSettingsPage,Ve as SettingsPage};
