import{a as v,b as q,a6 as ye,u as D,e5 as be,r as S,f8 as le,bB as ce,el as Ce,bk as de,f9 as Se,eD as K,j as e,cQ as N,fa as Me,N as Le,Q as Ie,R as Re,eJ as Te,fb as Ae,cB as T,a8 as Fe,T as M,bp as Y,fc as ee,a7 as ue,f as B,l as X,ex as me,aC as Z,b0 as Ee,fd as we,aH as P,L as ke,fe as z,B as ge,dF as G,I as ve,cC as Pe,aJ as Be,aS as _,aK as Oe,ff as He,eH as pe,em as $e,a_ as De,bG as Ne,X as Ue,y as Ve,x as _e,fg as fe,cq as We,eI as qe,fh as ze,eo as Ge,an as Qe,e1 as Je,P as k,bM as U,a1 as Q,bx as te,E as $,fi as se,aI as Ke,s as Ye,bU as b,a2 as Xe,fj as Ze,cR as J,bq as et,eB as tt,eG as st,H as nt,a5 as at,aL as it,fk as rt,fl as ot,fm as lt}from"./strapi-Ct9MU9_y.js";import{S as ne}from"./SearchInput-CNmnKpes.js";import{u as ct}from"./hooks-BXWU-qPr.js";const ae=["json","component","media","richtext","dynamiczone","password","blocks"],dt=["createdAt","updatedAt"],ut=[...le,"strapi_assignee"],ie=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:l}=n,{formatMessage:c,locale:j}=v(),{trackUsage:d}=q(),i=ye("FiltersImpl",f=>f.permissions),[{query:p}]=D(),{schemas:u}=be(),L=S.useMemo(()=>i.filter(f=>f.action==="admin::users.read"&&f.subject===null).length>0,[i]),I=(p?.filters?.$and??[]).reduce((f,E)=>{const[h,x]=Object.entries(E)[0];if(typeof x.id!="object")return f;const r=x.id.$eq||x.id.$ne,C=s[h],o=C?.type==="relation"&&"target"in C&&C.target==="admin::user";return r&&(o||ut.includes(h))&&!f.includes(r)&&f.push(r),f},[]),{data:y,isLoading:m}=ce({filters:{id:{$in:I}}},{skip:I.length===0||!L}),{users:g=[]}=y??{},{metadata:A}=Ce(a,{selectFromResult:({data:f})=>({metadata:f?.contentType.metadatas??{}})}),O=de(j,{sensitivity:"base"}),F=S.useMemo(()=>{const[{properties:{fields:f=[]}={fields:[]}}]=i.filter(h=>h.action==="plugin::content-manager.explorer.read"&&h.subject===a);return["id","documentId",...f.filter(h=>{const x=s[h]??{};return x.type&&!ae.includes(x.type)}),...dt,...L?le:[]].map(h=>{const x=s[h];if(ae.includes(x.type))return null;const{mainField:r="",label:C}=A[h].list;let o={name:h,label:C??"",mainField:Se(x,r,{schemas:u,components:{}}),type:x.type};return x.type==="relation"&&"target"in x&&x.target==="admin::user"&&(o={...o,input:mt,options:g.map(w=>({label:K(w),value:w.id.toString()})),operators:[{label:c({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:c({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),x.type==="enumeration"&&(o={...o,options:x.enum.map(w=>({label:w,value:w}))}),o}).filter(Boolean).toSorted((h,x)=>O.compare(h.label,x.label))},[i,L,a,s,A,u,g,c,O]),R=f=>{f&&d("willFilterEntries")},H=f=>{const E=s[f.name];E&&d("didFilterEntries",{useRelation:E.type==="relation"})};return e.jsxs(N.Root,{disabled:t,options:F,onOpenChange:R,onChange:H,children:[e.jsx(N.Trigger,{}),e.jsx(N.Popover,{zIndex:499}),e.jsx(N.List,{})]})},mt=({name:t})=>{const[n,s]=S.useState(10),[a,l]=S.useState(""),{formatMessage:c}=v(),j=Me(a,300),{data:d,isLoading:i}=ce({pageSize:n,_q:j}),p=Le(t),u=g=>{g||s(10)},{users:L=[],pagination:I}=d??{},{pageCount:y=1,page:m=1}=I??{};return e.jsx(Ie,{value:p.value,"aria-label":c({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:u,onChange:g=>p.onChange(t,g),loading:i,onLoadMore:()=>s(n+10),hasMoreItems:m<y,onInputChange:g=>{l(g.currentTarget.value)},children:L.map(g=>e.jsx(Re,{value:g.id.toString(),children:K(g)},g.id))})},W=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:l}=v();let c=n;if(t==="date"&&(c=s(Te(n),{dateStyle:"full"})),t==="datetime"&&(c=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[j,d,i]=n.split(":"),p=new Date;p.setHours(j),p.setMinutes(d),p.setSeconds(i),c=a(p,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(c=l(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(c=l(n,{maximumFractionDigits:0})),Ae(c)},gt=({content:t,mainField:n})=>n?e.jsx(Y,{label:t[n.name],children:e.jsx(M,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(W,{type:n.type,value:t[n.name]})})}):null,pt=({content:t,mainField:n})=>{const{formatMessage:s}=v();return n?e.jsxs(T.Root,{children:[e.jsxs(T.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(Fe,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(T.Content,{children:t.map(a=>e.jsx(T.Item,{disabled:!0,children:e.jsx(M,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(W,{type:n.type,value:a[n.name]})})},a.id))})]}):null},ft=t=>t&&t[0]==="."?t.substring(1):t,he=({url:t,mime:n,alternativeText:s,name:a,ext:l,formats:c})=>{const j=ee(t);if(n.includes("image")){const p=c?.thumbnail?.url,u=ee(p)||j;return e.jsx(ue.Item,{src:u,alt:s||a,fallback:s||a,preview:!0})}const d=ft(l),i=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(Y,{description:i,children:e.jsx(xe,{children:d})})},xe=({children:t})=>e.jsx(B,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(ht,{variant:"sigma",textColor:"neutral600",children:t})}),ht=X(M)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,xt=({content:t})=>e.jsx(ue.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const l=`+${t.length-3}`;return e.jsx(xe,{children:l},a)}return s>3?null:e.jsx(he,{...n},a)})}),jt=({mainField:t,content:n})=>e.jsx(M,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:me(n,t)}),yt=({mainField:t,content:n,rowId:s,name:a})=>{const{model:l}=Z(),{formatMessage:c}=v(),{notifyStatus:j}=Ee(),[d,i]=S.useState(!1),[p]=a.split("."),{data:u,isLoading:L}=we({model:l,id:s,targetField:p},{skip:!d,refetchOnMountOrArgChange:!0}),I=Array.isArray(n)?n.length:n.count;return S.useEffect(()=>{u&&j(c({id:P("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[u,c,j]),e.jsxs(T.Root,{onOpenChange:y=>i(y),children:[e.jsx(T.Trigger,{onClick:y=>y.stopPropagation(),children:e.jsx(M,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:I>0?c({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:I}):"-"})}),e.jsxs(T.Content,{children:[L&&e.jsx(T.Item,{disabled:!0,children:e.jsx(ke,{small:!0,children:c({id:P("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),u?.results&&e.jsxs(e.Fragment,{children:[u.results.map(y=>e.jsx(T.Item,{children:e.jsx(M,{maxWidth:"50rem",ellipsis:!0,children:me(y,t)})},y.documentId)),u?.pagination&&u?.pagination.total>10&&e.jsx(T.Item,{"aria-disabled":!0,"aria-label":c({id:P("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(M,{children:"â€¦"})})]})]})]})},bt=({content:t,mainField:n,attribute:s,rowId:a,name:l})=>{if(!Ct(t,n,s))return e.jsx(M,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(xt,{content:t}):e.jsx(he,{...t});case"relation":return je(s.relation)?e.jsx(jt,{mainField:n,content:t}):e.jsx(yt,{rowId:a,mainField:n,content:t,name:l});case"component":return s.repeatable?e.jsx(pt,{mainField:n,content:t}):e.jsx(gt,{mainField:n,content:t});case"string":return e.jsx(Y,{description:t,children:e.jsx(M,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(W,{type:s.type,value:t})})});default:return e.jsx(M,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(W,{type:s.type,value:t})})}},Ct=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!z(a)}return s.type==="relation"?je(s.relation)?!z(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!z(t)},je=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),re=t=>{const n=ct(c=>c.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=D(),{formatMessage:a}=v(),{allowedActions:{canConfigureView:l}}=ge(n);return e.jsxs(G.Root,{children:[e.jsx(G.Trigger,{children:e.jsx(ve,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(Pe,{})})}),e.jsx(G.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(B,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[l?e.jsx(Be,{size:"S",startIcon:e.jsx(He,{}),variant:"secondary",tag:Oe,to:{pathname:"configurations/list",search:s.plugins?_.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(St,{...t})]})})]})},St=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=q(),{formatMessage:l,locale:c}=v(),{schema:j,model:d}=Z(),{list:i}=pe(d),p=de(c,{sensitivity:"base"}),u=j?.attributes??{},L=Object.keys(u).filter(m=>$e(u[m])).map(m=>({name:m,label:i.metadatas[m]?.label??""})).sort((m,g)=>p.compare(m.label,g.label)),I=m=>{a("didChangeDisplayedFields");const g=t.includes(m)?t.filter(A=>A!==m):[...t,m];s(g)},y=()=>{n()};return e.jsxs(B,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:1,borderWidth:0,maxHeight:"240px",padding:1,overflow:"auto",children:[e.jsxs(B,{justifyContent:"space-between",gap:2,children:[e.jsx(M,{tag:"legend",variant:"pi",fontWeight:"bold",children:l({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(De,{onClick:y,children:l({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(B,{direction:"column",alignItems:"stretch",children:L.map(m=>{const g=t.includes(m.name);return e.jsx(B,{wrap:"wrap",gap:2,background:g?"primary100":"transparent",hasRadius:!0,padding:2,marginBottom:1,children:e.jsx(Ne,{onCheckedChange:()=>I(m.name),checked:g,name:m.name,children:e.jsx(M,{fontSize:1,children:m.label})})},m.name)})})]})},{INJECT_COLUMN_IN_TABLE:Mt}=Je,oe=X($.Header)`
  overflow-wrap: anywhere;
`,Lt=()=>{const{trackUsage:t}=q(),n=Ue(),{formatMessage:s}=v(),{toggleNotification:a}=Ve(),{_unstableFormatAPIError:l}=_e(P),{collectionType:c,model:j,schema:d}=Z(),{list:i}=pe(j),[p,u]=S.useState([]),L=fe(i.layout);S.useEffect(()=>{We(L,i.layout)||u(i.layout)},[i.layout,L]);const I=r=>{u(rt(r,d.attributes,i.metadatas))},[{query:y}]=D({page:"1",pageSize:i.settings.pageSize.toString(),sort:i.settings.defaultSortBy?`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`:""}),m=S.useMemo(()=>qe(y),[y]),{data:g,error:A,isFetching:O}=ze({model:j,params:m});S.useEffect(()=>{A&&a({type:"danger",message:l(A)})},[A,l,a]);const{results:F=[],pagination:R}=g??{};S.useEffect(()=>{R&&R.pageCount>0&&R.page>R.pageCount&&n({search:_.stringify({...y,page:R.pageCount})},{replace:!0})},[R,s,y,n]);const{canCreate:H}=Ge("ListViewPage",({canCreate:r})=>({canCreate:r})),f=Qe("ListViewPage",({runHookWaterfall:r})=>r),E=S.useMemo(()=>{const C=f(Mt,{displayedHeaders:p,layout:i}).displayedHeaders.map(o=>{const w=typeof o.label=="string"?{id:`content-manager.content-types.${j}.${o.name}`,defaultMessage:o.label}:o.label;return{...o,label:s(w),name:`${o.name}${o.mainField?.name?`.${o.mainField.name}`:""}`}});return d?.options?.draftAndPublish&&C.push({attribute:{type:"custom"},name:"status",label:s({id:P("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),C},[p,s,i,f,d?.options?.draftAndPublish,j]);if(O)return e.jsx(k.Loading,{});if(A)return e.jsx(k.Error,{});const h=d?.info.displayName?s({id:d.info.displayName,defaultMessage:d.info.displayName}):s({id:"content-manager.containers.untitled",defaultMessage:"Untitled"}),x=r=>()=>{t("willEditEntryFromList"),n({pathname:r.toString(),search:_.stringify({plugins:y.plugins})})};return!O&&F.length===0?e.jsxs(e.Fragment,{children:[e.jsx(U.contentManager.Introduction,{children:e.jsx(Q,{})}),e.jsxs(k.Main,{children:[e.jsx(k.Title,{children:`${h}`}),e.jsx(oe,{primaryAction:H?e.jsx(U.contentManager.CreateNewEntry,{children:e.jsx(V,{})}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:R?.total}),title:h,navigationAction:e.jsx(te,{})}),e.jsx($.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(se,{area:"listView.actions"}),e.jsx(re,{setHeaders:I,resetHeaders:()=>u(i.layout),headers:p.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(ne,{disabled:F.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:h}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&d?e.jsx(ie,{disabled:F.length===0,schema:d}):null]})}),e.jsx($.Content,{children:e.jsx(Q,{background:"neutral0",shadow:"filterShadow",hasRadius:!0,children:e.jsx(Ke,{action:H?e.jsx(V,{variant:"secondary"}):null,content:s({id:"app.components.EmptyStateLayout.content-document",defaultMessage:"No content found"}),hasRadius:!0,icon:e.jsx(Ye,{width:"16rem"})})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(U.contentManager.Introduction,{children:e.jsx(Q,{})}),e.jsxs(k.Main,{children:[e.jsx(k.Title,{children:`${h}`}),e.jsx(oe,{primaryAction:H?e.jsx(U.contentManager.CreateNewEntry,{children:e.jsx(V,{})}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:R?.total}),title:h,navigationAction:e.jsx(te,{})}),e.jsx($.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(se,{area:"listView.actions"}),e.jsx(re,{setHeaders:I,resetHeaders:()=>u(i.layout),headers:p.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(ne,{disabled:F.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:h}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&d?e.jsx(ie,{disabled:F.length===0,schema:d}):null]})}),e.jsx($.Content,{children:e.jsxs(B,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(b.Root,{rows:F,headers:E,isLoading:O,children:[e.jsx(Rt,{}),e.jsxs(b.Content,{children:[e.jsxs(b.Head,{children:[e.jsx(b.HeaderCheckboxCell,{}),E.map(r=>e.jsx(b.HeaderCell,{...r},r.name))]}),e.jsx(b.Loading,{}),e.jsx(b.Empty,{action:H?e.jsx(V,{variant:"secondary"}):null}),e.jsx(b.Body,{children:F.map(r=>e.jsxs(b.Row,{cursor:"pointer",onClick:x(r.documentId),children:[e.jsx(b.CheckboxCell,{id:r.id}),E.map(({cellFormatter:C,...o})=>{if(o.name==="status"){const{status:w}=r;return e.jsx(b.Cell,{children:e.jsx(Xe,{status:w,maxWidth:"min-content"})},o.name)}return["createdBy","updatedBy"].includes(o.name.split(".")[0])?e.jsx(b.Cell,{children:e.jsx(M,{textColor:"neutral800",children:r[o.name.split(".")[0]]?K(r[o.name.split(".")[0]]):"-"})},o.name):typeof C=="function"?e.jsx(b.Cell,{children:C(r,o,{collectionType:c,model:j})},o.name):e.jsx(b.Cell,{children:e.jsx(bt,{content:r[o.name.split(".")[0]],rowId:r.documentId,...o})},o.name)}),e.jsx(It,{onClick:C=>C.stopPropagation(),children:e.jsx(Ze,{document:r})})]},r.id))})]})]}),e.jsxs(J.Root,{...R,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(J.PageSize,{}),e.jsx(J.Links,{})]})]})})]})]})},It=X(b.Cell)`
  display: flex;
  justify-content: flex-end;
`,Rt=()=>{const t=ot("TableActionsBar",l=>l.selectRow),[{query:n}]=D(),s=n?.plugins?.i18n?.locale,a=fe(s);return S.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(b.ActionBar,{children:e.jsx(lt,{})})},V=({variant:t})=>{const{formatMessage:n}=v(),{trackUsage:s}=q(),[{query:a}]=D();return e.jsx(nt,{variant:t,tag:at,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(it,{}),style:{textDecoration:"none"},to:{pathname:"create",search:_.stringify({plugins:a.plugins})},minWidth:"max-content",marginLeft:2,children:n({id:P("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},Et=()=>{const{slug:t=""}=et(),{permissions:n=[],isLoading:s,error:a}=ge(tt.map(l=>({action:l,subject:t})));return s?e.jsx(k.Loading,{}):a||!t?e.jsx(k.Error,{}):e.jsx(k.Protect,{permissions:n,children:({permissions:l})=>e.jsx(st,{permissions:l,children:e.jsx(Lt,{})})})};export{Lt as ListViewPage,Et as ProtectedListViewPage};
